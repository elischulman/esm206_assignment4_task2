---
title: "Juvenile Snowshoe Hares - Bonanza Creek"
author: "Eli Schulman"
date: "11/3/2021"
output: html_document
---

***Introduction: ***

***Data and Analysis: *** 

***Data Citation: *** Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(kableExtra)
library(effsize)
```


```{r}
# read in the data
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv")) %>% 
  clean_names() %>% 
# filter for just juvenile hares
  filter(age %in% c("j", "J")) %>% 
# clean date using lubridate
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date))
```

### Annual Juvenile Snowshoe Hare Trap Coounts

```{r}
# create new df to be used for trap trends
hare_traps <- bonanza_hares %>% 
  group_by(year) %>% 
  summarize(hares_trapped = n())

# visualize the trap counts by year for all juvenile hares
ggplot(hare_traps, aes(x = year, y = hares_trapped)) +
  geom_bar(stat = "identity", 
           fill = "burlywood4",
           width = .5) +
  scale_x_discrete(limit = c(1999:2012)) +
  theme_minimal() +
  labs (title = "Hares Trapped at Bonanza Creek",
        y = "# of Hares",
        x = "Year",
        caption = "Juvenile Snowshoe Hares trapped at the Bonanza Creek Expirimental Forest") +
  theme(plot.title = element_text(hjust = .5)) 
```

```{r, include = FALSE}
# generate descriptive stats to include in analysis
traps_trends <- hare_traps %>%
  summarize(mean = round(mean(hares_trapped),0),
            max = max(hares_trapped),
            min = min(hares_trapped),
            standard_deviation = sd(hares_trapped))
```
Trapped Snowshoes Takeaway: There is a observed decline in Juvenile Snowshoe Hares at Bonanza Creek between 1999 and 2012. However, there are also gaps in the data where no trapped hares were observed (2002, 2009). This indicates that sampling techniques may have lacked in those years, and more generally, could be waning over time. This would be consistent with the observed decline in hare trappings over the years, too. That being said, the average count of juvenile Hares in the study was 32 per year, with a max count of 126 in 1999. This might reflect a relatively high level of interest in the sampling at the onset of the project. 

### Juvenile Snowshoe Hare Weights by Sex and Grid

```{r}
# Create simple df to compare weights by sex and grid
hare_weight <- bonanza_hares %>% 
  select(grid, sex, weight) %>% 
  mutate(sex = case_when(
    sex == "f" ~ "Female",
    sex == "m" ~ "Male",
    TRUE ~ "NA"
  ))

# Summarize averages and min/max of weight by sex and grid
# these numbers will be used in the figure caption to add context to the visualizations
weight_avg <- hare_weight %>% 
  group_by(grid, sex) %>% 
  summarize(observations = n(),
            mean_weight = mean(weight, na.rm = TRUE),
            min_weight = min(weight, na.rm = TRUE),
            max_weight = max(weight, na.rm = TRUE))

# Create visualization to show spread of weights by sex and grid
ggplot(hare_weight, aes(x = weight)) +
  geom_histogram(aes(fill = sex),
                 bins = 10,
                 color = "black",
                 alpha = .8) +
  labs(title = "Juvenile Hare Weight Distribution by Site",
       x = "Weight (g)",
       y = "# of Hares",
       fill = "Sex",
       caption = "Figure 2") +
  theme(plot.title = element_text(hjust = .5)) +
  scale_fill_manual(values = c("deeppink3","dodgerblue","grey")) +
  facet_wrap(~ grid) 
```

Fig-2 Caption: Mean Juvenile Snowshoe Hare weights for females at bonbs, bonmat, and bonrip are `r round(weight_avg$mean_weight[1],0)`(g), `r round(weight_avg$mean_weight[4],0)`(g), and `r round(weight_avg$mean_weight[7],0)`(g), respectively. The mean weight for male hares are `r round(weight_avg$mean_weight[2],0)`(g), `r round(weight_avg$mean_weight[5],0)`(g), and `r round(weight_avg$mean_weight[8],0)`(g), respectively. 

### Juvenile Snowshoe Hare Weight Comparisons

#### Create lists of weights for males and females

```{r}
# Create a vector for female weights, remove NAs (used in t test)
f_list <- hare_weight %>% 
  filter(sex == "Female") %>% 
  drop_na(weight) %>% 
  pull(weight)

# Create a vector for male weights, remove NAs (used in t test)
m_list <- hare_weight %>% 
  filter(sex == "Male") %>% 
  drop_na(weight) %>% 
  pull(weight)
```

#### Descriptive Statistics for Weights in grams (male vs female)

```{r}
# generate descriptive statistics table 
weight_comp <- hare_weight %>% 
  select(sex, weight) %>% 
  drop_na(sex, weight) %>% 
  group_by(sex) %>% 
  summarize(mean = round(mean(weight), 0),
            sd = round(sd(weight), 0),
            n())

# format table using kableExtra package
kable(weight_comp, 
      col = c("Sex", "Mean (g)", "Standard Deviation (g)", "Sampel Size"),
      caption = "Female vs Male Juvenile Snowshoe Hare Weights") %>% 
kable_styling(full_width = FALSE,
              position = "float_left")
```

```{r, include = FALSE}
# Exploratory graphs for male and female hare weights (do not include in report)

# use hist() to check for normality
hist(f_list)

hist(m_list)

# run a two-sample t-test on the male and female weights
weight_t_test <- t.test(f_list, m_list)

# test for the effect size between male and female weights
cohen.d(f_list, m_list)
```

Descriptive Statistics Analysis: In the given samples, male and female juvenile Snowshoe Hares have mean weights of 946g and 855g, respectively, for a mean difference of 91g.

Still need in this analysis for c.iii 
- explanation of cohens d (effect size)
- explanation of t-test findings 


### Juvenile Hare Weight and Hind Foot Length

```{r}
# create df to compare weight and hind foot
hare_wt_ft <- bonanza_hares %>% 
  select(weight, hindft) %>% 
  drop_na(weight, hindft)

ggplot(hare_wt_ft, aes(x = weight, y = hindft)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(title = "Juvenile Snowshoe Hare Weight vs Hind Foot Length",
       x = "Weight (g)",
       y = "Hind Foot Length (mm)",
       caption = "For the Hares in the study, we expect that for every 3.13g increase 
       in hare weight we will observe a 10mm increase in hind foot length") +
  theme(plot.title = element_text(hjust = .5)) 

hare_lm <- lm(hindft ~ weight, data = hare_wt_ft)
hare_lm

```




